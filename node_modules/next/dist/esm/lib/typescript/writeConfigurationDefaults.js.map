{"version":3,"sources":["../../../src/lib/typescript/writeConfigurationDefaults.ts"],"sourcesContent":["import { readFileSync, writeFileSync } from 'fs'\nimport { bold, cyan, white } from '../picocolors'\nimport * as CommentJson from 'next/dist/compiled/comment-json'\nimport semver from 'next/dist/compiled/semver'\nimport os from 'os'\nimport type { CompilerOptions } from 'typescript'\nimport * as Log from '../../build/output/log'\n\ntype DesiredCompilerOptionsShape = {\n  [K in keyof CompilerOptions]:\n    | { suggested: any; reason?: string }\n    | {\n        parsedValue?: any\n        parsedValues?: Array<any>\n        value: any\n        reason: string\n      }\n}\n\nfunction getDesiredCompilerOptions(\n  typescriptVersion: string,\n  userTsConfig?: Record<string, any>\n): DesiredCompilerOptionsShape {\n  // ModuleKind\n  const moduleKindESNext = 'esnext'\n  const moduleKindES2020 = 'es2020'\n  const moduleKindPreserve = 'preserve'\n  const moduleKindNodeNext = 'nodenext'\n  const moduleKindNode16 = 'node16'\n  const moduleKindCommonJS = 'commonjs'\n  const moduleKindAMD = 'amd'\n\n  // ModuleResolutionKind\n  const moduleResolutionKindBundler = 'bundler'\n  const moduleResolutionKindNode10 = 'node10'\n  const moduleResolutionKindNode12 = 'node12'\n  const moduleResolutionKindNodeJs = 'node'\n\n  // Jsx\n  const jsxEmitReactJSX = 'react-jsx'\n\n  return {\n    target: {\n      suggested: 'ES2017',\n      reason:\n        'For top-level `await`. Note: Next.js only polyfills for the esmodules target.',\n    },\n    // These are suggested values and will be set when not present in the\n    // tsconfig.json\n    lib: { suggested: ['dom', 'dom.iterable', 'esnext'] },\n    allowJs: { suggested: true },\n    skipLibCheck: { suggested: true },\n    strict: { suggested: false },\n    noEmit: { suggested: true },\n    incremental: { suggested: true },\n\n    // These values are required and cannot be changed by the user\n    // Keep this in sync with the webpack config\n    // 'parsedValue' matches the output value from ts.parseJsonConfigFileContent()\n    module: {\n      parsedValue: moduleKindESNext,\n      // All of these values work:\n      parsedValues: [\n        semver.gte(typescriptVersion, '5.4.0') && moduleKindPreserve,\n        moduleKindES2020,\n        moduleKindESNext,\n        moduleKindCommonJS,\n        moduleKindAMD,\n        moduleKindNodeNext,\n        moduleKindNode16,\n      ],\n      value: 'esnext',\n      reason: 'for dynamic import() support',\n    },\n    // TODO: Semver check not needed once Next.js repo uses 5.4.\n    ...(semver.gte(typescriptVersion, '5.4.0') &&\n    userTsConfig?.compilerOptions?.module?.toLowerCase() === moduleKindPreserve\n      ? {\n          // TypeScript 5.4 introduced `Preserve`. Using `Preserve` implies\n          // - `moduleResolution` is `Bundler`\n          // - `esModuleInterop` is `true`\n          // - `resolveJsonModule` is `true`\n          // This means that if the user is using Preserve, they don't need these options\n        }\n      : {\n          esModuleInterop: {\n            value: true,\n            reason: 'requirement for SWC / babel',\n          },\n          moduleResolution: {\n            // In TypeScript 5.0, `NodeJs` has renamed to `Node10`\n            parsedValue: moduleResolutionKindBundler,\n            // All of these values work:\n            parsedValues: [\n              moduleResolutionKindNode10,\n              moduleResolutionKindNodeJs,\n              // only newer TypeScript versions have this field, it\n              // will be filtered for new versions of TypeScript\n              moduleResolutionKindNode12,\n              moduleKindNode16,\n              moduleKindNodeNext,\n              moduleResolutionKindBundler,\n            ].filter((val) => typeof val !== 'undefined'),\n            value: 'node',\n            reason: 'to match webpack resolution',\n          },\n          resolveJsonModule: {\n            value: true,\n            reason: 'to match webpack resolution',\n          },\n        }),\n    ...(userTsConfig?.compilerOptions?.verbatimModuleSyntax === true\n      ? undefined\n      : {\n          isolatedModules: {\n            value: true,\n            reason: 'requirement for SWC / Babel',\n          },\n        }),\n    jsx: {\n      parsedValue: jsxEmitReactJSX,\n      value: 'react-jsx',\n      reason: 'next.js uses the React automatic runtime',\n    },\n  } satisfies DesiredCompilerOptionsShape\n}\n\nexport function getRequiredConfiguration(\n  typescript: typeof import('typescript')\n): Partial<import('typescript').CompilerOptions> {\n  const res: Partial<import('typescript').CompilerOptions> = {}\n  const typescriptVersion = typescript.version\n\n  const desiredCompilerOptions = getDesiredCompilerOptions(typescriptVersion)\n  for (const optionKey of Object.keys(desiredCompilerOptions)) {\n    const ev = desiredCompilerOptions[optionKey]\n    if (!('value' in ev)) {\n      continue\n    }\n\n    const value = ev.parsedValue ?? ev.value\n\n    // Convert string values back to TypeScript enum values\n    if (optionKey === 'module' && typeof value === 'string') {\n      const moduleMap: Record<string, import('typescript').ModuleKind> = {\n        esnext: typescript.ModuleKind.ESNext,\n        es2020: typescript.ModuleKind.ES2020,\n        ...(typescript.ModuleKind.Preserve !== undefined\n          ? { preserve: typescript.ModuleKind.Preserve }\n          : {}),\n        nodenext: typescript.ModuleKind.NodeNext,\n        node16: typescript.ModuleKind.Node16,\n        commonjs: typescript.ModuleKind.CommonJS,\n        amd: typescript.ModuleKind.AMD,\n      }\n      res[optionKey] = moduleMap[value.toLowerCase()] ?? value\n    } else if (optionKey === 'moduleResolution' && typeof value === 'string') {\n      const moduleResolutionMap: Record<\n        string,\n        import('typescript').ModuleResolutionKind\n      > = {\n        bundler: typescript.ModuleResolutionKind.Bundler,\n        node10: typescript.ModuleResolutionKind.Node10,\n        node12: (typescript.ModuleResolutionKind as any).Node12,\n        node: typescript.ModuleResolutionKind.NodeJs,\n      }\n      res[optionKey] = moduleResolutionMap[value.toLowerCase()] ?? value\n    } else if (optionKey === 'jsx' && typeof value === 'string') {\n      const jsxMap: Record<string, import('typescript').JsxEmit> = {\n        'react-jsx': typescript.JsxEmit.ReactJSX,\n      }\n      res[optionKey] = jsxMap[value.toLowerCase()] ?? value\n    } else {\n      res[optionKey] = value\n    }\n  }\n\n  return res\n}\n\nconst localDevTestFilesExcludeAction =\n  'NEXT_PRIVATE_LOCAL_DEV_TEST_FILES_EXCLUDE'\n\nexport async function writeConfigurationDefaults(\n  typescriptVersion: string,\n  tsConfigPath: string,\n  isFirstTimeSetup: boolean,\n  hasAppDir: boolean,\n  distDir: string,\n  hasPagesDir: boolean\n): Promise<void> {\n  if (isFirstTimeSetup) {\n    writeFileSync(tsConfigPath, '{}' + os.EOL)\n  }\n\n  const userTsConfigContent = readFileSync(tsConfigPath, {\n    encoding: 'utf8',\n  })\n  const userTsConfig = CommentJson.parse(userTsConfigContent)\n\n  // Bail automatic setup when the user has extended or referenced another config\n  if ('extends' in userTsConfig || 'references' in userTsConfig) {\n    return\n  }\n\n  if (userTsConfig?.compilerOptions == null) {\n    userTsConfig.compilerOptions = {}\n    isFirstTimeSetup = true\n  }\n\n  const desiredCompilerOptions = getDesiredCompilerOptions(\n    typescriptVersion,\n    userTsConfig\n  )\n\n  const suggestedActions: string[] = []\n  const requiredActions: string[] = []\n  for (const optionKey in desiredCompilerOptions) {\n    const check = desiredCompilerOptions[optionKey]\n    if ('suggested' in check) {\n      if (!(optionKey in userTsConfig?.compilerOptions)) {\n        userTsConfig.compilerOptions[optionKey] = check.suggested\n        suggestedActions.push(\n          cyan(optionKey) +\n            ' was set to ' +\n            bold(check.suggested) +\n            (check.reason ? ` (${check.reason})` : '')\n        )\n      }\n    } else if ('value' in check) {\n      let existingValue = userTsConfig?.compilerOptions?.[optionKey]\n\n      if (typeof existingValue === 'string') {\n        existingValue = existingValue.toLowerCase()\n      }\n\n      const shouldWriteRequiredValue = () => {\n        // Check if the option has multiple allowed values\n        if (check.parsedValues) {\n          return !check.parsedValues.includes(existingValue)\n        }\n\n        // Check if the option has a single parsed value\n        if (check.parsedValue) {\n          return check.parsedValue !== existingValue\n        }\n\n        // Fall back to direct value comparison\n        return check.value !== existingValue\n      }\n\n      if (shouldWriteRequiredValue()) {\n        if (!userTsConfig.compilerOptions) {\n          userTsConfig.compilerOptions = {}\n        }\n        userTsConfig.compilerOptions[optionKey] = check.value\n        requiredActions.push(\n          cyan(optionKey) +\n            ' was set to ' +\n            bold(check.value) +\n            ` (${check.reason})`\n        )\n      }\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const _: never = check\n    }\n  }\n\n  const nextAppTypes = `${distDir}/types/**/*.ts`\n\n  if (!('include' in userTsConfig)) {\n    userTsConfig.include = hasAppDir\n      ? ['next-env.d.ts', nextAppTypes, '**/*.mts', '**/*.ts', '**/*.tsx']\n      : ['next-env.d.ts', '**/*.mts', '**/*.ts', '**/*.tsx']\n    suggestedActions.push(\n      cyan('include') +\n        ' was set to ' +\n        bold(\n          hasAppDir\n            ? `['next-env.d.ts', '${nextAppTypes}', '**/*.mts', '**/*.ts', '**/*.tsx']`\n            : `['next-env.d.ts', '**/*.mts', '**/*.ts', '**/*.tsx']`\n        )\n    )\n  } else if (hasAppDir) {\n    const missingFromResolved = []\n    if (!userTsConfig.include.includes(nextAppTypes)) {\n      missingFromResolved.push(nextAppTypes)\n    }\n\n    if (missingFromResolved.length > 0) {\n      if (!Array.isArray(userTsConfig.include)) {\n        userTsConfig.include = []\n      }\n\n      missingFromResolved.forEach((item) => {\n        userTsConfig.include.push(item)\n        suggestedActions.push(\n          cyan('include') + ' was updated to add ' + bold(`'${item}'`)\n        )\n      })\n    }\n  }\n\n  // Enable the Next.js typescript plugin.\n  if (hasAppDir) {\n    // Check if the config or the resolved config has the plugin already.\n    const plugins = [\n      ...(Array.isArray(userTsConfig?.plugins) ? userTsConfig.plugins : []),\n      ...(userTsConfig.compilerOptions &&\n      Array.isArray(userTsConfig.compilerOptions.plugins)\n        ? userTsConfig.compilerOptions.plugins\n        : []),\n    ]\n    const hasNextPlugin = plugins.some(\n      ({ name }: { name: string }) => name === 'next'\n    )\n\n    // If the TS config extends on another config, we can't add the `plugin` field\n    // because that will override the parent config's plugins.\n    // Instead we have to show a message to the user to add the plugin manually.\n    if (\n      !userTsConfig.compilerOptions ||\n      (plugins.length &&\n        !hasNextPlugin &&\n        'extends' in userTsConfig &&\n        (!userTsConfig.compilerOptions ||\n          !userTsConfig.compilerOptions.plugins))\n    ) {\n      Log.info(\n        `\\nYour ${bold(\n          'tsconfig.json'\n        )} extends another configuration, which means we cannot add the Next.js TypeScript plugin automatically. To improve your development experience, we recommend adding the Next.js plugin (\\`${cyan(\n          '\"plugins\": [{ \"name\": \"next\" }]'\n        )}\\`) manually to your TypeScript configuration. Learn more: https://nextjs.org/docs/app/api-reference/config/typescript#the-typescript-plugin\\n`\n      )\n    } else if (!hasNextPlugin) {\n      if (!('plugins' in userTsConfig.compilerOptions)) {\n        userTsConfig.compilerOptions.plugins = []\n      }\n      userTsConfig.compilerOptions.plugins.push({ name: 'next' })\n      suggestedActions.push(\n        cyan('plugins') + ' was updated to add ' + bold(`{ name: 'next' }`)\n      )\n    }\n\n    // If `strict` is set to `false` and `strictNullChecks` is set to `false`,\n    // then set `strictNullChecks` to `true`.\n    if (\n      hasPagesDir &&\n      hasAppDir &&\n      !userTsConfig?.compilerOptions?.strict &&\n      !('strictNullChecks' in userTsConfig?.compilerOptions)\n    ) {\n      userTsConfig.compilerOptions.strictNullChecks = true\n      suggestedActions.push(\n        cyan('strictNullChecks') + ' was set to ' + bold(`true`)\n      )\n    }\n  }\n\n  if (!('exclude' in userTsConfig)) {\n    userTsConfig.exclude = ['node_modules']\n    suggestedActions.push(\n      cyan('exclude') + ' was set to ' + bold(`['node_modules']`)\n    )\n  }\n\n  // During local development inside Next.js repo, exclude the test files coverage by the local tsconfig\n  if (process.env.NEXT_PRIVATE_LOCAL_DEV && userTsConfig.exclude) {\n    const tsGlob = '**/*.test.ts'\n    const tsxGlob = '**/*.test.tsx'\n    let hasUpdates = false\n    if (!userTsConfig.exclude.includes(tsGlob)) {\n      userTsConfig.exclude.push(tsGlob)\n      hasUpdates = true\n    }\n    if (!userTsConfig.exclude.includes(tsxGlob)) {\n      userTsConfig.exclude.push(tsxGlob)\n      hasUpdates = true\n    }\n\n    if (hasUpdates) {\n      requiredActions.push(localDevTestFilesExcludeAction)\n    }\n  }\n\n  if (suggestedActions.length < 1 && requiredActions.length < 1) {\n    return\n  }\n\n  writeFileSync(\n    tsConfigPath,\n    CommentJson.stringify(userTsConfig, null, 2) + os.EOL\n  )\n\n  Log.info('')\n  if (isFirstTimeSetup) {\n    Log.info(\n      `We detected TypeScript in your project and created a ${cyan(\n        'tsconfig.json'\n      )} file for you.`\n    )\n    return\n  }\n\n  Log.info(\n    `We detected TypeScript in your project and reconfigured your ${cyan(\n      'tsconfig.json'\n    )} file for you.${\n      userTsConfig.compilerOptions?.strict\n        ? ''\n        : ` Strict-mode is set to ${cyan('false')} by default.`\n    }`\n  )\n\n  if (suggestedActions.length) {\n    Log.info(\n      `The following suggested values were added to your ${cyan(\n        'tsconfig.json'\n      )}. These values ${cyan('can be changed')} to fit your project's needs:\\n`\n    )\n\n    suggestedActions.forEach((action) => Log.info(`\\t- ${action}`))\n\n    Log.info('')\n  }\n\n  const requiredActionsToBeLogged = process.env.NEXT_PRIVATE_LOCAL_DEV\n    ? requiredActions.filter(\n        (action) => action !== localDevTestFilesExcludeAction\n      )\n    : requiredActions\n\n  if (requiredActionsToBeLogged.length) {\n    Log.info(\n      `The following ${white('mandatory changes')} were made to your ${cyan(\n        'tsconfig.json'\n      )}:\\n`\n    )\n\n    requiredActionsToBeLogged.forEach((action) => Log.info(`\\t- ${action}`))\n\n    Log.info('')\n  }\n}\n"],"names":["readFileSync","writeFileSync","bold","cyan","white","CommentJson","semver","os","Log","getDesiredCompilerOptions","typescriptVersion","userTsConfig","moduleKindESNext","moduleKindES2020","moduleKindPreserve","moduleKindNodeNext","moduleKindNode16","moduleKindCommonJS","moduleKindAMD","moduleResolutionKindBundler","moduleResolutionKindNode10","moduleResolutionKindNode12","moduleResolutionKindNodeJs","jsxEmitReactJSX","target","suggested","reason","lib","allowJs","skipLibCheck","strict","noEmit","incremental","module","parsedValue","parsedValues","gte","value","compilerOptions","toLowerCase","esModuleInterop","moduleResolution","filter","val","resolveJsonModule","verbatimModuleSyntax","undefined","isolatedModules","jsx","getRequiredConfiguration","typescript","res","version","desiredCompilerOptions","optionKey","Object","keys","ev","moduleMap","esnext","ModuleKind","ESNext","es2020","ES2020","Preserve","preserve","nodenext","NodeNext","node16","Node16","commonjs","CommonJS","amd","AMD","moduleResolutionMap","bundler","ModuleResolutionKind","Bundler","node10","Node10","node12","Node12","node","NodeJs","jsxMap","JsxEmit","ReactJSX","localDevTestFilesExcludeAction","writeConfigurationDefaults","tsConfigPath","isFirstTimeSetup","hasAppDir","distDir","hasPagesDir","EOL","userTsConfigContent","encoding","parse","suggestedActions","requiredActions","check","push","existingValue","shouldWriteRequiredValue","includes","_","nextAppTypes","include","missingFromResolved","length","Array","isArray","forEach","item","plugins","hasNextPlugin","some","name","info","strictNullChecks","exclude","process","env","NEXT_PRIVATE_LOCAL_DEV","tsGlob","tsxGlob","hasUpdates","stringify","action","requiredActionsToBeLogged"],"mappings":"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","ignoreList":[0]}